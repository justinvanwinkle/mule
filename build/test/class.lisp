
(DEFPACKAGE "class"
  (:USE "CL" "SB-EXT"))
(IN-PACKAGE "class")
(REQUIRE 'ASDF)
(IF (NOT (EQUAL (PACKAGE-NAME *PACKAGE*) "builtins"))
    (ASDF/OPERATE:LOAD-SYSTEM :MULE))
(DEFPARAMETER |a| 1)
(DEFCLASS A NIL (|a| |b|))
(DEFMETHOD |init| ((|self| A) |a|) (SETF (SLOT-VALUE |self| '|a|) |a|))
(DEFMETHOD |meth| ((|self| A))
  (RETURN-FROM |meth| (+ (SLOT-VALUE |self| '|a|) 1)))
(DEFUN A (|a|)
  (LET ((|self| (MAKE-INSTANCE 'A)))
    (|init| |self| |a|)
    |self|))
(SETF |a| (A 1))
(ASSERT (EQUALP (SLOT-VALUE |a| '|a|) 1))
(ASSERT (EQUALP (|meth| |a|) 2))
(LOOP FOR S BEING EACH PRESENT-SYMBOL IN *PACKAGE*
      WHEN (OR (FBOUNDP S) (BOUNDP S) (FIND-CLASS S NIL))
      DO (EXPORT S))