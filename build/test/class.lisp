
(EVAL-WHEN (:COMPILE-TOPLEVEL)
  (SETF *READTABLE* (COPY-READTABLE NIL))
  (SETF (READTABLE-CASE *READTABLE*) :PRESERVE))
(DEFPACKAGE "class"
  (:USE "CL" "SB-EXT"))
(IN-PACKAGE "class")
(DEFPARAMETER a 1)
(DEFCLASS A NIL (a b))
(DEFMETHOD init ((self A) a) (SETF (SLOT-VALUE self 'a) a))
(DEFMETHOD meth ((self A)) (RETURN-FROM meth (+ (SLOT-VALUE self 'a) 1)))
(DEFUN A (a)
  (LET ((self (MAKE-INSTANCE 'A)))
    (init self a)
    self))
(SETF a (A 1))
(ASSERT (EQUALP (SLOT-VALUE a 'a) 1))
(ASSERT (EQUALP (meth a) 2))